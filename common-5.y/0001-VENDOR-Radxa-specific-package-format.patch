From 969980afb47e0c2614ae2914ffc349eb9ad0a392 Mon Sep 17 00:00:00 2001
From: Yuntian Zhang <yt@radxa.com>
Date: Tue, 26 Apr 2022 20:06:38 +0800
Subject: [PATCH] VENDOR: Radxa specific package format

Signed-off-by: Yuntian Zhang <yt@radxa.com>
---
 scripts/Makefile.package | 2 ++
 scripts/package/mkdebian | 5 ++++-
 2 files changed, 6 insertions(+), 1 deletion(-)

diff --git a/scripts/Makefile.package b/scripts/Makefile.package
index f952fb64789d..baaaebd8e2cc 100644
--- a/scripts/Makefile.package
+++ b/scripts/Makefile.package
@@ -78,6 +78,8 @@ deb-pkg:
 	+dpkg-buildpackage -r$(KBUILD_PKG_ROOTCMD) -a$$(cat debian/arch) $(DPKG_FLAGS) -i.git -us -uc
 
 PHONY += bindeb-pkg
+bindeb-pkg: export FORK = $(FORK)
+bindeb-pkg: export SUPPORTED_BOARDS = $(SUPPORTED_BOARDS)
 bindeb-pkg:
 	$(CONFIG_SHELL) $(srctree)/scripts/package/mkdebian
 	+dpkg-buildpackage -r$(KBUILD_PKG_ROOTCMD) -a$$(cat debian/arch) $(DPKG_FLAGS) -b -nc -uc
diff --git a/scripts/package/mkdebian b/scripts/package/mkdebian
index 60a2a63a5e90..6e068b22e77f 100755
--- a/scripts/package/mkdebian
+++ b/scripts/package/mkdebian
@@ -179,6 +179,7 @@ Build-Depends: bc, rsync, kmod, cpio, bison, flex | flex:native $extra_build_dep
 Homepage: https://www.kernel.org/
 
 Package: $packagename-$version
+Provides: $packagename-$FORK,$(echo $SUPPORTED_BOARDS | sed -e 's/[^,]*/ linux-image-&/g')
 Architecture: $debarch
 Description: Linux kernel, version $version
  This package contains the Linux kernel, modules and corresponding other
@@ -186,7 +187,7 @@ Description: Linux kernel, version $version
 
 Package: linux-libc-dev
 Section: devel
-Provides: linux-kernel-headers
+Provides: linux-kernel-headers, linux-libc-dev-$FORK, linux-kernel-headers-$FORK,$(echo $SUPPORTED_BOARDS | sed -e 's/[^,]*/ linux-kernel-headers-&/g')
 Architecture: $debarch
 Description: Linux support headers for userspace development
  This package provides userspaces headers from the Linux kernel.  These headers
@@ -198,6 +199,7 @@ if is_enabled CONFIG_MODULES; then
 cat <<EOF >> debian/control
 
 Package: linux-headers-$version
+Provides: linux-headers-$FORK,$(echo $SUPPORTED_BOARDS | sed -e 's/[^,]*/ linux-headers-&/g')
 Architecture: $debarch
 Description: Linux kernel headers for $version on $debarch
  This package provides kernel header files for $version on $debarch
@@ -211,6 +213,7 @@ cat <<EOF >> debian/control
 
 Package: linux-image-$version-dbg
 Section: debug
+Provides: linux-image-dbg-$FORK,$(echo $SUPPORTED_BOARDS | sed -e 's/[^,]*/ linux-image-dbg-&/g')
 Architecture: $debarch
 Description: Linux kernel debugging symbols for $version
  This package will come in handy if you need to debug the kernel. It provides
-- 
2.35.1

