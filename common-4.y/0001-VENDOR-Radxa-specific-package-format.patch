From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: Yuntian Zhang <yt@radxa.com>
Date: Fri, 29 Apr 2022 16:32:28 +0800
Subject: [PATCH] VENDOR: Radxa specific package format

Signed-off-by: Yuntian Zhang <yt@radxa.com>
---
 scripts/package/Makefile | 6 ++++--
 scripts/package/mkdebian | 5 ++++-
 2 files changed, 8 insertions(+), 3 deletions(-)

diff --git a/scripts/package/Makefile b/scripts/package/Makefile
index 73503ebce632..5bd5da793ad0 100644
--- a/scripts/package/Makefile
+++ b/scripts/package/Makefile
@@ -73,11 +73,13 @@ deb-pkg: FORCE
 	$(call cmd,src_tar,$(KDEB_SOURCENAME))
 	origversion=$$(dpkg-parsechangelog -SVersion |sed 's/-[^-]*$$//');\
 		mv $(KDEB_SOURCENAME).tar.gz ../$(KDEB_SOURCENAME)_$${origversion}.orig.tar.gz
-	+dpkg-buildpackage -r$(KBUILD_PKG_ROOTCMD) -a$$(cat debian/arch) -i.git -us -uc
+	+dpkg-buildpackage -r$(KBUILD_PKG_ROOTCMD) -a$$(cat debian/arch) $(DPKG_FLAGS) -i.git -us -uc
 
+bindeb-pkg: export FORK = $(FORK)
+bindeb-pkg: export SUPPORTED_BOARDS = $(SUPPORTED_BOARDS)
 bindeb-pkg: FORCE
 	$(CONFIG_SHELL) $(srctree)/scripts/package/mkdebian
-	+dpkg-buildpackage -r$(KBUILD_PKG_ROOTCMD) -a$$(cat debian/arch) -b -nc -uc
+	+dpkg-buildpackage -r$(KBUILD_PKG_ROOTCMD) -a$$(cat debian/arch) $(DPKG_FLAGS) -b -nc -uc
 
 intdeb-pkg: FORCE
 	+$(CONFIG_SHELL) $(srctree)/scripts/package/builddeb
diff --git a/scripts/package/mkdebian b/scripts/package/mkdebian
index edcad61fe3cd..1f492bec5c5b 100755
--- a/scripts/package/mkdebian
+++ b/scripts/package/mkdebian
@@ -174,12 +174,14 @@ Build-Depends: bc, kmod, cpio
 Homepage: http://www.kernel.org/
 
 Package: $packagename
+Provides: linux-image-$FORK,$(echo $SUPPORTED_BOARDS | sed -e 's/[^,]*/ linux-image-&/g')
 Architecture: $debarch
 Description: Linux kernel, version $version
  This package contains the Linux kernel, modules and corresponding other
  files, version: $version.
 
 Package: $kernel_headers_packagename
+Provides: linux-headers-$FORK,$(echo $SUPPORTED_BOARDS | sed -e 's/[^,]*/ linux-headers-&/g')
 Architecture: $debarch
 Description: Linux kernel headers for $version on $debarch
  This package provides kernel header files for $version on $debarch
@@ -188,7 +190,7 @@ Description: Linux kernel headers for $version on $debarch
 
 Package: linux-libc-dev
 Section: devel
-Provides: linux-kernel-headers
+Provides: linux-kernel-headers, linux-libc-dev-$FORK, linux-kernel-headers-$FORK,$(echo $SUPPORTED_BOARDS | sed -e 's/[^,]*/ linux-kernel-headers-&/g')
 Architecture: $debarch
 Description: Linux support headers for userspace development
  This package provides userspaces headers from the Linux kernel.  These headers
@@ -196,6 +198,7 @@ Description: Linux support headers for userspace development
 
 Package: $dbg_packagename
 Section: debug
+Provides: linux-image-dbg-$FORK,$(echo $SUPPORTED_BOARDS | sed -e 's/[^,]*/ linux-image-dbg-&/g')
 Architecture: $debarch
 Description: Linux kernel debugging symbols for $version
  This package will come in handy if you need to debug the kernel. It provides
-- 
2.35.1

