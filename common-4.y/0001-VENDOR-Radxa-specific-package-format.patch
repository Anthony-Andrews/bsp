From 06846f6fb721a77bef1c3841f13e90187297402a Mon Sep 17 00:00:00 2001
From: Yuntian Zhang <yt@radxa.com>
Date: Fri, 29 Apr 2022 16:32:28 +0800
Subject: [PATCH] VENDOR: Radxa specific package format

Signed-off-by: Yuntian Zhang <yt@radxa.com>
---
 scripts/package/Makefile |  8 ++++++--
 scripts/package/builddeb |  8 ++++----
 scripts/package/mkdebian | 13 ++++++++-----
 3 files changed, 18 insertions(+), 11 deletions(-)

diff --git a/scripts/package/Makefile b/scripts/package/Makefile
index 73503ebce632..7b57ce77d1ea 100644
--- a/scripts/package/Makefile
+++ b/scripts/package/Makefile
@@ -73,12 +73,16 @@ deb-pkg: FORCE
 	$(call cmd,src_tar,$(KDEB_SOURCENAME))
 	origversion=$$(dpkg-parsechangelog -SVersion |sed 's/-[^-]*$$//');\
 		mv $(KDEB_SOURCENAME).tar.gz ../$(KDEB_SOURCENAME)_$${origversion}.orig.tar.gz
-	+dpkg-buildpackage -r$(KBUILD_PKG_ROOTCMD) -a$$(cat debian/arch) -i.git -us -uc
+	+dpkg-buildpackage -r$(KBUILD_PKG_ROOTCMD) -a$$(cat debian/arch) $(DPKG_FLAGS) -i.git -us -uc
 
+bindeb-pkg: export FORK = $(FORK)
+bindeb-pkg: export SUPPORTED_BOARDS = $(SUPPORTED_BOARDS)
 bindeb-pkg: FORCE
 	$(CONFIG_SHELL) $(srctree)/scripts/package/mkdebian
-	+dpkg-buildpackage -r$(KBUILD_PKG_ROOTCMD) -a$$(cat debian/arch) -b -nc -uc
+	+dpkg-buildpackage -r$(KBUILD_PKG_ROOTCMD) -a$$(cat debian/arch) $(DPKG_FLAGS) -b -nc -uc
 
+intdeb-pkg: export FORK = $(FORK)
+intdeb-pkg: export SUPPORTED_BOARDS = $(SUPPORTED_BOARDS)
 intdeb-pkg: FORCE
 	+$(CONFIG_SHELL) $(srctree)/scripts/package/builddeb
 
diff --git a/scripts/package/builddeb b/scripts/package/builddeb
index 4c2b8413269e..e78d868ace15 100755
--- a/scripts/package/builddeb
+++ b/scripts/package/builddeb
@@ -39,10 +39,10 @@ tmpdir="$objtree/debian/tmp"
 kernel_headers_dir="$objtree/debian/hdrtmp"
 libc_headers_dir="$objtree/debian/headertmp"
 dbg_dir="$objtree/debian/dbgtmp"
-packagename=linux-image-$version
-kernel_headers_packagename=linux-headers-$version
-libc_headers_packagename=linux-libc-dev
-dbg_packagename=$packagename-dbg
+packagename=linux-image-$FORK
+kernel_headers_packagename=linux-headers-$FORK
+libc_headers_packagename=linux-libc-dev-$FORK
+dbg_packagename=linux-image-dbg-$FORK
 
 if [ "$ARCH" = "um" ] ; then
 	packagename=user-mode-linux-$version
diff --git a/scripts/package/mkdebian b/scripts/package/mkdebian
index edcad61fe3cd..07b17635a81c 100755
--- a/scripts/package/mkdebian
+++ b/scripts/package/mkdebian
@@ -94,9 +94,9 @@ else
 	packageversion=$version-$revision
 fi
 sourcename=$KDEB_SOURCENAME
-packagename=linux-image-$version
-kernel_headers_packagename=linux-headers-$version
-dbg_packagename=$packagename-dbg
+packagename="linux-image-$FORK"
+kernel_headers_packagename="linux-headers-$FORK"
+dbg_packagename="linux-image-dbg-$FORK"
 debarch=
 set_debarch
 
@@ -174,21 +174,23 @@ Build-Depends: bc, kmod, cpio
 Homepage: http://www.kernel.org/
 
 Package: $packagename
+Provides:$(echo $SUPPORTED_BOARDS | sed -e 's/[^,]*/ linux-image-&/g')
 Architecture: $debarch
 Description: Linux kernel, version $version
  This package contains the Linux kernel, modules and corresponding other
  files, version: $version.
 
 Package: $kernel_headers_packagename
+Provides:$(echo $SUPPORTED_BOARDS | sed -e 's/[^,]*/ linux-headers-&/g')
 Architecture: $debarch
 Description: Linux kernel headers for $version on $debarch
  This package provides kernel header files for $version on $debarch
  .
  This is useful for people who need to build external modules
 
-Package: linux-libc-dev
+Package: linux-libc-dev-$FORK
 Section: devel
-Provides: linux-kernel-headers
+Provides: linux-kernel-headers,$(echo $SUPPORTED_BOARDS | sed -e 's/[^,]*/ linux-kernel-headers-&/g')
 Architecture: $debarch
 Description: Linux support headers for userspace development
  This package provides userspaces headers from the Linux kernel.  These headers
@@ -196,6 +198,7 @@ Description: Linux support headers for userspace development
 
 Package: $dbg_packagename
 Section: debug
+Provides:$(echo $SUPPORTED_BOARDS | sed -e 's/[^,]*/ linux-image-dbg-&/g')
 Architecture: $debarch
 Description: Linux kernel debugging symbols for $version
  This package will come in handy if you need to debug the kernel. It provides
-- 
2.35.1

